<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PipCore</title>

  <!-- 1. Synchronous Core SDKs -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="%VITE_TG_ANALYTICS_URL%"></script> <!-- Removed async -->

  <!-- 2. Robust Analytics Initialization -->
  <script>
    let analyticsInitialized = false;
    
    try {
      window.telegramAnalytics.init({
        token: 'eyJhcHBfbmFtZSI6IlBpcENvcmUiLCJhcHBfdXJsIjoiaHR0cHM6Ly90Lm1lL3BpcGNvcmVib3Q/cHJvZmlsZSIsImFwcF9kb21haW4iOiJodHRwczovL3NpbmFzbGwuZ2l0aHViLmlvL1BpcENvcmUvIn0=!4SggM7v6aszOEalTectRvX5S+cTTBpCO2d/vQk+ouYs=',
        appName: 'PipCore'
      });
      window.telegramAnalytics.track('start');
      analyticsInitialized = true;
    } catch (error) {
      console.error('Analytics init failed:', error);
      analyticsInitialized = false;
    }

    // Initialize WebApp
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();
  </script>

  <!-- Your styles -->
  <link href="style.css" rel="stylesheet">
</head>
<body>
  <div class="loading-container">
    <!-- Loading screen content -->
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const startTime = Date.now();
      const loader = document.querySelector('.loading-container');
      
      // Simulated loading progress
      const loadComplete = () => {
        // Track completion if analytics loaded
        if(analyticsInitialized) {
          window.telegramAnalytics.track('loading_complete', {
            duration: Date.now() - startTime
          });
        }

        // Visual fade-out
        loader.style.opacity = '0';
        
        // Delay redirect for event transmission
        setTimeout(() => {
          window.location.href = 'profile.html';
        }, analyticsInitialized ? 300 : 0); // Only delay if analytics works
      };

      // Simulate loading progress
      let progress = 0;
      const interval = setInterval(() => {
        progress = Math.min(progress + Math.random() * 3, 100);
        document.querySelector('.progress').textContent = `${Math.floor(progress)}%`;
        
        if(progress >= 100) {
          clearInterval(interval);
          loadComplete();
        }
      }, 100);

      // Fallback timeout
      setTimeout(() => {
        clearInterval(interval);
        loadComplete();
      }, 5000);
    });
  </script>
</body>
</html>