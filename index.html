<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PipCore</title>

  <!-- 1. Load Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- 2. Load Telegram Analytics SDK via CDN with async and onload handler -->
  <script async src="https://tganalytics.xyz/index.js" onload="initAnalytics()" type="text/javascript"></script>

  <!-- 3. Analytics Initialization -->
  <script>
    let analyticsInitialized = false;

    function initAnalytics() {
      try {
        window.telegramAnalytics.init({
          token: 'eyJhcHBfbmFtZSI6IlBpcENvcmUiLCJhcHBfdXJsIjoiaHR0cHM6Ly90Lm1lL3BpcGNvcmVib3Q/cHJvZmlsZSIsImFwcF9kb21haW4iOiJodHRwczovL3NpbmFzbGwuZ2l0aHViLmlvL1BpcENvcmUvIn0=!4SggM7v6aszOEalTectRvX5S+cTTBpCO2d/vQk+ouYs=', // Replace with your actual token
          appName: 'PipCore' // Replace with your actual analytics identifier if different
        });
        // Optional: Track a "start" event immediately after initialization
        window.telegramAnalytics.track('start');
        analyticsInitialized = true;
      } catch (error) {
        console.error('Analytics init failed:', error);
        analyticsInitialized = false;
      }
    }

    // Initialize Telegram WebApp
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();
  </script>

  <!-- Your styles -->
  <link href="style.css" rel="stylesheet">
</head>
<body>
  <div class="loading-container">
    <!-- Loading screen content -->
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const startTime = Date.now();
      const loader = document.querySelector('.loading-container');
      
      // Function to complete loading
      const loadComplete = () => {
        if (analyticsInitialized) {
          window.telegramAnalytics.track('loading_complete', {
            duration: Date.now() - startTime
          });
        }
        loader.style.opacity = '0';
        setTimeout(() => {
          window.location.href = 'profile.html';
        }, analyticsInitialized ? 300 : 0);
      };

      // Simulate loading progress
      let progress = 0;
      const interval = setInterval(() => {
        progress = Math.min(progress + Math.random() * 3, 100);
        document.querySelector('.progress').textContent = `${Math.floor(progress)}%`;
        if (progress >= 100) {
          clearInterval(interval);
          loadComplete();
        }
      }, 100);

      // Fallback timeout
      setTimeout(() => {
        clearInterval(interval);
        loadComplete();
      }, 5000);
    });
  </script>
</body>
</html>